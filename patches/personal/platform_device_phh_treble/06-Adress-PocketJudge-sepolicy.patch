From 75f68a5b888dbfc52269fb1125ab41e90f945476 Mon Sep 17 00:00:00 2001
From: ChonDoit <thphantomblog@gmail.com>
Date: Mon, 10 Oct 2022 18:04:14 +0000
Subject: [PATCH] Adress Pocket Judge sepolicy

---
 sepolicy/file.te          | 2 ++
 sepolicy/file_contexts    | 3 +++
 sepolicy/service.te       | 3 +++
 sepolicy/service_contexts | 3 +++
 sepolicy/system_server.te | 5 +++++
 5 files changed, 16 insertions(+)
 create mode 100644 sepolicy/file.te

diff --git a/sepolicy/file.te b/sepolicy/file.te
new file mode 100644
index 0000000..48c5be9
--- /dev/null
+++ b/sepolicy/file.te
@@ -0,0 +1,2 @@
+# Pocket Judge
+type pocket_judge_sysfs, fs_type, sysfs_type;
diff --git a/sepolicy/file_contexts b/sepolicy/file_contexts
index 09cde27..9d5a4b9 100644
--- a/sepolicy/file_contexts
+++ b/sepolicy/file_contexts
@@ -22,3 +22,6 @@
 
 /dev/smcinvoke u:object_r:smcinvoke_device:s0
 /system/bin/hw/android\.hardware\.bluetooth\.audio-service-system u:object_r:hal_audio_sysbta_exec:s0
+
+# Pocket Judge
+/sys/kernel/pocket_judge(/.*)?	                u:object_r:pocket_judge_sysfs:s0
diff --git a/sepolicy/service.te b/sepolicy/service.te
index 5715fbf..8da883a 100644
--- a/sepolicy/service.te
+++ b/sepolicy/service.te
@@ -1,2 +1,5 @@
 # App Lock
 type app_lock_service, system_api_service, system_server_service, service_manager_type;
+
+# Poxket Judge
+type pocket_service, system_api_service, system_server_service, service_manager_type;
diff --git a/sepolicy/service_contexts b/sepolicy/service_contexts
index 5eb21fe..38da2bc 100644
--- a/sepolicy/service_contexts
+++ b/sepolicy/service_contexts
@@ -14,3 +14,6 @@ android.hardware.bluetooth.audio.IBluetoothAudioProviderFactory/sysbta    u:obje
 
 # App Lock
 app_lock                                  u:object_r:app_lock_service:s0
+
+# Pocket Judge
+pocket                                    u:object_r:pocket_service:s0
diff --git a/sepolicy/system_server.te b/sepolicy/system_server.te
index caa158f..2f9c18e 100644
--- a/sepolicy/system_server.te
+++ b/sepolicy/system_server.te
@@ -1,2 +1,7 @@
 # App Lock
 add_service(system_server, app_lock_service);
+
+# Pocket Judge
+allow system_server pocket_judge_sysfs:dir search;
+allow system_server pocket_judge_sysfs:file rw_file_perms;
+allow system_server pocket_service:service_manager { add find };
-- 
2.34.1

