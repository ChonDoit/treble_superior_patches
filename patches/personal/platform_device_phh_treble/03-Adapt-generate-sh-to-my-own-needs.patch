From ce5cdd4ad2c356b3f5fa3ba0fd93581972359aad Mon Sep 17 00:00:00 2001
From: ChonDoit <thphantomblog@gmail.com>
Date: Sun, 16 Oct 2022 14:53:48 +0000
Subject: [PATCH] Adapt generate.sh to my own needs

---
 generate.sh | 95 +++++++++++++----------------------------------------
 1 file changed, 22 insertions(+), 73 deletions(-)

diff --git a/generate.sh b/generate.sh
index fac8208..03a2102 100644
--- a/generate.sh
+++ b/generate.sh
@@ -14,92 +14,41 @@ fi
 
 echo 'PRODUCT_MAKEFILES := \' > AndroidProducts.mk
 
-for part in a ab;do
-	for apps in vanilla gapps foss gapps-go;do
-		for arch in arm64 arm a64;do
-			for su in yes no;do
-				apps_suffix=""
-				apps_script=""
-				apps_name=""
-				extra_packages=""
-                vndk="vndk.mk"
-		optional_base=""
-				if [ "$apps" == "gapps" ];then
-					apps_suffix="g"
-					apps_script='$(call inherit-product, device/phh/treble/gapps.mk)'
-					apps_name="with GApps"
-				fi
-				if [ "$apps" == "gapps-go" ];then
-					apps_suffix="o"
-					apps_script='$(call inherit-product, device/phh/treble/gapps-go.mk)'
-					apps_name="Go"
-				fi
-				if [ "$apps" == "foss" ];then
-					apps_suffix="f"
-					apps_script='$(call inherit-product, vendor/foss/foss.mk)'
-					apps_name="with FOSS apps"
-				fi
-				if [ "$apps" == "vanilla" ];then
-					apps_suffix="v"
-					apps_script=''
-					apps_name="vanilla"
-				fi
-				if [ "$arch" == "arm" ];then
-					vndk="vndk-binder32.mk"
-				fi
-				if [ "$arch" == "a64" ];then
-					vndk="vndk32.mk"
-				fi
+arch='arm64'
+zygote=64_32
+gapps_suffix='g'
+su_suffix='S'
+secureflag='($(PHH-SECURE_BUILD)'
 
-				su_suffix='N'
-				if [ "$su" == "yes" ];then
-					su_suffix='S'
-					extra_packages+=' phh-su me.phh.superuser'
-				fi
+target="treble_${arch}_bgS"
 
-				part_suffix='a'
-				if [ "$part" == 'ab' ];then
-					part_suffix='b'
-				else
-					optional_base='$(call inherit-product, device/phh/treble/base-sas.mk)'
-				fi
+cat > ${target}.mk << EOF
 
-				target="treble_${arch}_${part_suffix}${apps_suffix}${su_suffix}"
-
-				baseArch="$arch"
-				if [ "$arch" = "a64" ];then
-					baseArch="arm"
-				fi
-
-				zygote=32
-				if [ "$arch" = "arm64" ];then
-					zygote=64_32
-				fi
-
-				cat > ${target}.mk << EOF
-TARGET_GAPPS_ARCH := ${baseArch}
+# PHH Calls
 \$(call inherit-product, device/phh/treble/base-pre.mk)
-include build/make/target/product/aosp_${baseArch}.mk
+include build/make/target/product/aosp_${arch}.mk
 \$(call inherit-product, device/phh/treble/base.mk)
-$optional_base
-$apps_script
+
+# Source Call
 $rom_script
 
-PRODUCT_NAME := $target
-PRODUCT_DEVICE := phhgsi_${arch}_$part
+# GSI Props
+PRODUCT_DEVICE := phhgsi_arm64_ab
 PRODUCT_BRAND := google
 PRODUCT_SYSTEM_BRAND := google
-PRODUCT_MODEL := Phh-Treble $apps_name
+PRODUCT_MODEL := Phh-Treble
 
 # Overwrite the inherited "emulator" characteristics
 PRODUCT_CHARACTERISTICS := device
 
-PRODUCT_PACKAGES += $extra_packages
-
+# Secure build?
+ifeq ${secureflag}, true)
+        PRODUCT_NAME := treble_arm64_bgN
+                else
+        PRODUCT_NAME := treble_arm64_bgS
+        PRODUCT_PACKAGES += phh-su SuperUser
+endif
 EOF
 echo -e '\t$(LOCAL_DIR)/'$target.mk '\' >> AndroidProducts.mk
-			done
-		done
-	done
-done
 echo >> AndroidProducts.mk
+
-- 
2.34.1

