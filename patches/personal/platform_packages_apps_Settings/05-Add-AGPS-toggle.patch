From 524401f306439374708ec8aee02d99cdb33eb7ad Mon Sep 17 00:00:00 2001
From: ChonDoit <thphantomblog@gmail.com>
Date: Thu, 17 Aug 2023 03:36:56 +0000
Subject: [PATCH] A-GPS

---
 res/values/superior_strings.xml               |  3 +
 res/xml/location_settings.xml                 |  8 +-
 .../location/AgpsPreferenceController.java    | 74 +++++++++++++++++++
 .../settings/location/LocationSettings.java   |  1 +
 4 files changed, 85 insertions(+), 1 deletion(-)
 create mode 100644 src/com/android/settings/location/AgpsPreferenceController.java

diff --git a/res/values/superior_strings.xml b/res/values/superior_strings.xml
index 215a30b21f..235d3f3901 100644
--- a/res/values/superior_strings.xml
+++ b/res/values/superior_strings.xml
@@ -388,4 +388,7 @@
     <string name="doze_on_charge_title">Always on when charging</string>
     <string name="doze_on_charge_summary">Show doze screen all the time when charging</string>
 
+    <!-- Location settings screen, setting summary for Assisted GPS switch -->
+    <string name="assisted_gps">A-GPS</string>
+    <string name="assisted_gps_summary">Use satellite assistance data from the internet.</string>
 </resources>
diff --git a/res/xml/location_settings.xml b/res/xml/location_settings.xml
index fe87efd73d..6bcab4e64c 100644
--- a/res/xml/location_settings.xml
+++ b/res/xml/location_settings.xml
@@ -33,7 +33,13 @@
         android:icon="@drawable/ic_chevron_right_24dp"
         android:fragment="com.android.settings.location.RecentLocationAccessSeeAllFragment"
         settings:controller="com.android.settings.location.RecentLocationAccessSeeAllButtonPreferenceController"
-        settings:searchable="false"/>
+	    settings:searchable="false"/>
+
+    <SwitchPreference
+        android:key="assisted_gps"
+        android:title="@string/assisted_gps"
+        android:summary="@string/assisted_gps_summary"
+        settings:controller="com.android.settings.location.AgpsPreferenceController"/>
 
     <PreferenceCategory
         android:key="location_advanced_settings"
diff --git a/src/com/android/settings/location/AgpsPreferenceController.java b/src/com/android/settings/location/AgpsPreferenceController.java
new file mode 100644
index 0000000000..8fed53a0d8
--- /dev/null
+++ b/src/com/android/settings/location/AgpsPreferenceController.java
@@ -0,0 +1,74 @@
+/*
+ * Copyright (C) 2011 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.settings.location;
+
+import android.content.ContentResolver;
+import android.content.Context;
+import android.provider.Settings;
+
+import androidx.preference.SwitchPreference;
+import androidx.preference.Preference;
+import androidx.preference.PreferenceScreen;
+
+public class AgpsPreferenceController extends LocationBasePreferenceController {
+    private static final String KEY_ASSISTED_GPS = "assisted_gps";
+
+    private SwitchPreference mAgpsPreference;
+
+    public AgpsPreferenceController(Context context, String key) {
+        super(context, key);
+    }
+
+    @Override
+    public String getPreferenceKey() {
+        return KEY_ASSISTED_GPS;
+    }
+
+    @AvailabilityStatus
+    public int getAvailabilityStatus() {
+        return AVAILABLE;
+    }
+
+    @Override
+    public void displayPreference(PreferenceScreen screen) {
+        super.displayPreference(screen);
+        mAgpsPreference = (SwitchPreference) screen.findPreference(KEY_ASSISTED_GPS);
+    }
+
+    @Override
+    public void updateState(Preference preference) {
+        if (mAgpsPreference != null) {
+            mAgpsPreference.setChecked(Settings.Global.getInt(
+                    mContext.getContentResolver(), Settings.Global.ASSISTED_GPS_ENABLED, 1) == 1);
+        }
+    }
+
+    @Override
+    public boolean handlePreferenceTreeClick(Preference preference) {
+        if (KEY_ASSISTED_GPS.equals(preference.getKey())) {
+            final ContentResolver cr = mContext.getContentResolver();
+            final boolean switchState = mAgpsPreference.isChecked();
+            Settings.Global.putInt(cr, Settings.Global.ASSISTED_GPS_ENABLED,
+                    switchState ? 1 : 0);
+            return true;
+        }
+        return false;
+    }
+
+    @Override
+    public void onLocationModeChanged(int mode, boolean restricted) {}
+}
diff --git a/src/com/android/settings/location/LocationSettings.java b/src/com/android/settings/location/LocationSettings.java
index ff8b4be390..08d58e16d2 100644
--- a/src/com/android/settings/location/LocationSettings.java
+++ b/src/com/android/settings/location/LocationSettings.java
@@ -109,6 +109,7 @@ public class LocationSettings extends DashboardFragment implements
         use(RecentLocationAccessSeeAllButtonPreferenceController.class).init(this);
         use(LocationForWorkPreferenceController.class).init(this);
         use(LocationSettingsFooterPreferenceController.class).init(this);
+	use(AgpsPreferenceController.class).init(this);
     }
 
     @Override
-- 
2.34.1

