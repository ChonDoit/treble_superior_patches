From c71c38fb502c8b2af5d1f451c34a23b4653b3c65 Mon Sep 17 00:00:00 2001
From: ChonDoit <thphantomblog@gmail.com>
Date: Sun, 7 May 2023 15:32:54 +0000
Subject: [PATCH] PocketLock: Make using light sensor optional

On some devices using light sensor may break autobrightness
---
 core/java/android/pocket/PocketConstants.java               | 6 ------
 .../core/java/com/android/server/pocket/PocketService.java  | 4 +++-
 core/res/res/values/cornelio_configs.xml | 7 +++++++
 3 files changed, 10 insertions(+), 7 deletions(-)
 create mode 100644 core/res/res/values/cornelio_configs.xml

diff --git a/core/java/android/pocket/PocketConstants.java b/core/java/android/pocket/PocketConstants.java
index f0d08a272375..70aa74a7f2a6 100644
--- a/core/java/android/pocket/PocketConstants.java
+++ b/core/java/android/pocket/PocketConstants.java
@@ -16,10 +16,4 @@ public class PocketConstants {
      */
     public static final boolean ENABLE_PROXIMITY_JUDGE = true;
 
-    /**
-     * Whether to use light sensor to evaluate pocket state.
-     */
-    public static final boolean ENABLE_LIGHT_JUDGE = true;
-
-
 }
diff --git a/services/core/java/com/android/server/pocket/PocketService.java b/services/core/java/com/android/server/pocket/PocketService.java
index 5cfa5cf464e8..2d1f795721ea 100644
--- a/services/core/java/com/android/server/pocket/PocketService.java
+++ b/services/core/java/com/android/server/pocket/PocketService.java
@@ -587,6 +587,8 @@ public class PocketService extends SystemService implements IBinder.DeathRecipie
 
     private void startListeningForLight() {
 
+	boolean mUseLightSensor = mContext.getResources().getBoolean(com.android.internal.R.bool.config_pocketUseLightSensor);
+
         if (mVendorSensor != null) {
             return;
         }
@@ -595,7 +597,7 @@ public class PocketService extends SystemService implements IBinder.DeathRecipie
             Log.d(TAG, "startListeningForLight()");
         }
 
-        if (!PocketConstants.ENABLE_LIGHT_JUDGE) {
+        if (!mUseLightSensor) {
             return;
         }
 
diff --git a/core/res/res/values/cornelio_configs.xml b/core/res/res/values/cornelio_configs.xml
new file mode 100644
index 000000000000..ed71e3d6b3e5
--- /dev/null
+++ b/core/res/res/values/cornelio_configs.xml
@@ -0,0 +1,7 @@
+<resources>
+
+	<!-- Pocket Service -->
+	<bool name="config_pocketUseLightSensor">true</bool>
+	<java-symbol type="bool" name="config_pocketUseLightSensor" />
+
+</resources>
-- 
2.34.1

